<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Design Basis Web Tool</title>
<style>
  body{font-family:Arial,sans-serif;margin:12px;background:#f7f7f7;}
  header{text-align:center;margin-bottom:12px;}
  #sheets{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;}
  .sheet-btn{padding:8px 12px;background:#fff;border:1px solid #ddd;border-radius:6px;cursor:pointer;}
  .sheet-btn.active{background:#007bff;color:#fff;border-color:#007bff;}
  #grid{overflow:auto;background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.06);}
  table{border-collapse:collapse;}
  td,th{border:1px solid #e6e6e6;padding:6px;min-width:90px;max-width:200px;}
  input.cell-input{width:100%;box-sizing:border-box;border:none;background:transparent;padding:4px;}
  .formula{color:#1a73e8;font-size:12px;}
  .note{font-size:13px;color:#555;margin-top:8px;}
</style>
</head>
<body>
<header>
  <h1>Design Basis Web Tool</h1>
  <p>Converted from Excel. Editable cells = inputs. Formula cells recalc in browser.</p>
</header>

<div id="sheets"></div>
<div id="grid"></div>
<div class="note">Note: Basic Excel functions (SUM, AVERAGE, +,-,*,/,^) supported. Verify results with original Excel.</div>

<script>
let sheetsData={};
async function loadData(){
  const resp=await fetch('sheets_data.json'); sheetsData=await resp.json();
  renderSheetButtons(); showSheet(0);
}
function renderSheetButtons(){
  const container=document.getElementById('sheets'); container.innerHTML="";
  sheetsData.forEach((s,i)=>{
    const btn=document.createElement('button');
    btn.className='sheet-btn'+(i===0?' active':''); btn.textContent=s.title;
    btn.onclick=()=>{document.querySelectorAll('.sheet-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');showSheet(i);};
    container.appendChild(btn);
  });
}
let cellMap={};
function buildCellMap(sheet){cellMap={};sheet.cells.forEach(r=>{r.forEach(c=>{cellMap[c.addr]={value:c.value,formula:c.formula};});});}
function showSheet(index){
  const sheet=sheetsData[index]; buildCellMap(sheet);
  const grid=document.getElementById('grid'); grid.innerHTML="";
  const table=document.createElement('table'); const thead=document.createElement('thead'); const hr=document.createElement('tr');
  hr.appendChild(document.createElement('th')); for(let c=1;c<=sheet.max_col;c++){const th=document.createElement('th');th.textContent=columnName(c);hr.appendChild(th);} thead.appendChild(hr); table.appendChild(thead);
  const tbody=document.createElement('tbody');
  for(let r=1;r<=sheet.max_row;r++){const tr=document.createElement('tr');const th=document.createElement('th');th.textContent=r;tr.appendChild(th);
    for(let c=1;c<=sheet.max_col;c++){const addr=columnName(c)+r;const td=document.createElement('td');const ci=cellMap[addr]||{value:null,formula:null};
      if(ci.formula){const valDiv=document.createElement('div');valDiv.className='formula';valDiv.id='val_'+addr;valDiv.textContent=ci.formula;td.appendChild(valDiv);} 
      else {const inp=document.createElement('input');inp.className='cell-input';inp.dataset.addr=addr;inp.value=ci.value??"";inp.onchange=onInputChange;td.appendChild(inp);} 
      tr.appendChild(td);} tbody.appendChild(tr);} table.appendChild(tbody); grid.appendChild(table); recalcAll();
}
function columnName(n){let s='';while(n>0){let r=(n-1)%26;s=String.fromCharCode(65+r)+s;n=Math.floor((n-1)/26);}return s;}
function onInputChange(e){const addr=e.target.dataset.addr;const v=e.target.value;cellMap[addr].value=isNaN(Number(v))?v:Number(v);recalcAll();}
function cell(addr){addr=addr.toUpperCase();return cellMap[addr]?.value||0;}
function rangeToAddrs(rng){rng=rng.toUpperCase();if(!rng.includes(':'))return[rng];const [s,e]=rng.split(':');const si=s.match(/^([A-Z]+)(\d+)$/);const ei=e.match(/^([A-Z]+)(\d+)$/);if(!si||!ei)return[];const sc=lettersToNumber(si[1]),sr=parseInt(si[2]);const ec=lettersToNumber(ei[1]),er=parseInt(ei[2]);let a=[];for(let r=Math.min(sr,er);r<=Math.max(sr,er);r++){for(let c=Math.min(sc,ec);c<=Math.max(sc,ec);c++){a.push(columnName(c)+r);}}return a;}
function lettersToNumber(s){let n=0;for(let i=0;i<s.length;i++)n=n*26+(s.charCodeAt(i)-64);return n;}
function SUM(...args){let t=0;args.forEach(a=>{if(Array.isArray(a))a.forEach(x=>t+=Number(x||0));else if(typeof a==='string'){if(a.includes(':'))rangeToAddrs(a).forEach(ad=>t+=Number(cell(ad)));else if(a.match(/^[A-Z]+\d+$/))t+=Number(cell(a));else t+=Number(a);}else t+=Number(a||0);});return t;}
function AVERAGE(...args){let v=[];args.forEach(a=>{if(Array.isArray(a))v=v.concat(a);else if(typeof a==='string'){if(a.includes(':'))rangeToAddrs(a).forEach(ad=>v.push(cell(ad)));else if(a.match(/^[A-Z]+\d+$/))v.push(cell(a));else v.push(Number(a));}else v.push(a);});const nums=v.map(x=>Number(x||0));return nums.reduce((s,x)=>s+x,0)/(nums.length||1);}
function excelToJs(expr){if(!expr)return'0';if(expr[0]=='=')expr=expr.slice(1);expr=expr.replace(/\^/g,'**');expr=expr.replace(/([A-Z]+\d+:?[A-Z]*\d*)/ig,m=>m.includes(':')?`'${m.toUpperCase()}'`:`cell('${m.toUpperCase()}')`);expr=expr.replace(/\bSUM\s*\(/ig,'SUM(');expr=expr.replace(/\bAVERAGE\s*\(/ig,'AVERAGE(');return expr;}
function recalcAll(){Object.keys(cellMap).forEach(a=>{if(cellMap[a].formula){try{const js=excelToJs(cellMap[a].formula);const res=eval(js);cellMap[a].value=res;document.getElementById('val_'+a).textContent=res;}catch(e){document.getElementById('val_'+a).textContent='ERR';}}});}
loadData();
</script>
</body>
</html>